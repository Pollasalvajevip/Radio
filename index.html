async function buscarVideo() {
    const videoUrl = document.getElementById('videoUrl').value;
    const btn = document.getElementById('btnDescargar');
    const resultadoDiv = document.getElementById('resultado');
    const lista = document.getElementById('listaCalidades');

    if (!videoUrl) return alert("Por favor, pega una URL válida");

    btn.innerText = "Procesando... ⏳";
    btn.disabled = true;

    try {
        // Usamos una instancia pública de Cobalt
        const response = await fetch('https://api.cobalt.tools/api/json', {
            method: 'POST',
            headers: {
                'Cache-Control': 'no-cache',
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                url: videoUrl,
                vQuality: "720", // Calidad por defecto
                filenamePattern: "basic"
            })
        });

        const data = await response.json();

        if (data.status === 'stream' || data.status === 'picker' || data.status === 'redirect') {
            btn.innerText = "¡Encontrado! ✨";
            resultadoDiv.classList.remove('hidden');
            
            // Si es un solo video
            const finalUrl = data.url || (data.picker ? data.picker[0].url : '');
            
            lista.innerHTML = `
                <a href="${finalUrl}" target="_blank" download class="flex justify-between items-center bg-green-600 p-4 rounded-lg hover:bg-green-700 transition-all">
                    <span class="font-bold">DESCARGAR VIDEO</span>
                    <span class="text-white text-xl">↓</span>
                </a>
                <p class="text-xs text-slate-500 mt-2 text-center text-balance">Si no descarga al tocar, mantén presionado el botón y elige "Descargar vínculo".</p>
            `;
        } else {
            alert("No se pudo obtener el video. Revisa el link.");
        }
    } catch (error) {
        console.error(error);
        alert("Error de conexión. Inténtalo de nuevo.");
    } finally {
        btn.disabled = false;
        btn.innerText = "Analizar Enlace";
    }
}
